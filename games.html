<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play to Win - MicroEarn</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
            /* Space for sticky ad */
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .daily-limit {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 12px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .game-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .game-card:active {
            transform: scale(0.95);
        }

        .game-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .game-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .game-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .game-reward {
            color: #10b981;
            font-size: 12px;
            font-weight: 600;
        }

        .game-plays {
            color: #666;
            font-size: 11px;
            margin-top: 5px;
        }

        .game-plays.exhausted {
            color: #ff6b6b;
            font-weight: 600;
        }

        .game-card.disabled .game-plays {
            color: #ff6b6b;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.15);
            /* Light semi-transparent */
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            z-index: 100;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .back-btn:active {
            transform: scale(0.95);
        }

        /* Game Modal - Full screen scrollable layout */
        .game-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            flex-direction: column;
            overflow-y: auto;
        }

        .game-modal.show {
            display: flex;
        }

        .game-modal-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100%;
            padding-bottom: 80px;
        }

        .game-header {
            position: sticky;
            top: 0;
            width: 100%;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
            margin-bottom: 20px;
        }

        .game-plays-header {
            color: #ffd700;
            font-size: 12px;
            font-weight: 600;
        }

        .wheel-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            font-weight: 700;
            color: #333;
            text-align: center;
            pointer-events: none;
        }

        .game-back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .game-back-btn:active {
            background: rgba(255, 255, 255, 0.3);
        }

        .game-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Spin Wheel Overhaul */
        .wheel-container {
            position: relative;
            margin: 20px auto;
            width: 280px;
            height: 280px;
            /* Container for wheel + pointer + status */
        }

        .wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 35px solid #ff4757;
            filter: drop-shadow(0 4px 4px rgba(0, 0, 0, 0.4));
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            background: conic-gradient(#FF6B6B 0deg 60deg,
                    #4ECDC4 60deg 120deg,
                    #45B7D1 120deg 180deg,
                    #FFA07A 180deg 240deg,
                    #98D8C8 240deg 300deg,
                    #FFD93D 300deg 360deg);
            position: relative;
            overflow: hidden;
        }

        /* Wheel Labels */
        .wheel-label {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: 20px;
            margin-top: -10px;
            transform-origin: 0% 50%;
            text-align: right;
            padding-right: 25px;
            color: white;
            font-weight: 800;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            white-space: nowrap;
        }

        /* Rotation for labels (East based) to match Segments (Top based) */
        /* Seg 0 (0-60, center 30). East (90) - 60 = 30. */
        .label-0 {
            transform: rotate(-60deg);
        }

        .label-1 {
            transform: rotate(0deg);
        }

        .label-2 {
            transform: rotate(60deg);
        }

        .label-3 {
            transform: rotate(120deg);
        }

        .label-4 {
            transform: rotate(180deg);
        }

        .label-5 {
            transform: rotate(240deg);
        }

        /* Seg 5 (300-360, center 330). 90+240=330. */

        /* Highlight Overlay - Fixed at Top (Winning Position) */
        /* Since rotation brings winner to TOP, we just highlight TOP wedge. */
        .wheel-highlight {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 15;
            background: conic-gradient(rgba(255, 255, 255, 0.5) 0deg 30deg,
                    transparent 30deg 330deg,
                    rgba(255, 255, 255, 0.5) 330deg 360deg);
            opacity: 0;
            transition: opacity 0.5s;
            border-radius: 50%;
            mix-blend-mode: overlay;
        }

        .wheel-highlight.show {
            opacity: 1;
        }

        .wheel.dim {
            filter: brightness(0.6);
        }

        .action-btn {
            margin-top: 20px;
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            min-width: 150px;
        }

        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .action-btn.claimed {
            background: #10b981;
        }

        /* Tap Game */
        .tap-area {
            width: 180px;
            height: 180px;
            margin: 15px auto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            color: white;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s;
        }

        .tap-area:active {
            transform: scale(0.9);
        }

        .tap-count {
            font-size: 50px;
            font-weight: bold;
            color: #667eea;
        }

        .timer {
            font-size: 24px;
            color: #666;
            margin: 10px 0;
        }

        /* Guess Game */
        .guess-input {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 12px;
            margin: 10px 0;
        }

        .attempts {
            color: #666;
            margin: 10px 0;
        }

        /* Reaction Game */
        .reaction-box {
            width: 180px;
            height: 180px;
            margin: 15px auto;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
        }

        .reaction-box.waiting {
            background: #ff6b6b;
            color: white;
        }

        .reaction-box.ready {
            background: #2ecc71;
            color: white;
        }

        .reaction-time {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        /* Quiz Game */
        .quiz-question {
            font-size: 18px;
            margin-bottom: 15px;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 12px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        .quiz-option.correct {
            background: #2ecc71;
            color: white;
        }

        .quiz-option.wrong {
            background: #ff6b6b;
            color: white;
        }

        /* Catch Button */
        .catch-area {
            width: 100%;
            height: 250px;
            background: #f0f0f0;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .catch-target {
            position: absolute;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
        }

        /* Result - LARGE, CLEAR, HIGH CONTRAST */
        .result {
            font-size: 20px;
            margin: 15px 0;
            min-height: 30px;
        }

        .result.win {
            color: #2ecc71;
        }

        .result.lose {
            color: #ff6b6b;
        }

        .result.processing {
            color: #667eea;
        }

        /* GAME RESULT BOX - Large, Clear, Fixed */
        .game-result-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .result-score {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .result-requirement {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
        }

        .result-reward {
            font-size: 36px;
            font-weight: 800;
            margin: 15px 0;
        }

        .result-reward.win {
            color: #2ecc71;
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }

        .result-reward.lose {
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }

        .result-emoji {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .result-message {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
        }

        /* SPIN RESULT OVERLAY - Clear visibility */
        .spin-result-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }

        .spin-result-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .spin-result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            max-width: 90%;
            animation: scaleIn 0.4s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .spin-result-emoji {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .spin-result-title {
            font-size: 28px;
            color: white;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .spin-result-coins {
            font-size: 48px;
            color: #ffd700;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
        }

        .spin-result-status {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
            min-height: 30px;
        }

        .spin-result-success {
            color: #2ecc71;
            font-weight: 600;
        }

        .spin-result-close {
            margin-top: 25px;
            padding: 15px 40px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
        }

        /* POST-GAME FLOW */
        .post-game-actions {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: center;
        }

        .post-game-actions.show {
            display: block;
        }

        .reward-claimed-text {
            color: #2ecc71;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .back-to-hub-btn {
            padding: 14px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            display: none;
            z-index: 2000;
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                bottom: 60px;
                opacity: 0;
            }

            to {
                bottom: 80px;
                opacity: 1;
            }
        }

        /* Sticky Ad Banner */
        .sticky-ad {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #f9f9f9;
            border-top: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 900;
        }

        .sticky-ad.hidden {
            display: none;
        }

        .ad-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
        }

        .ad-close {
            position: absolute;
            right: 5px;
            top: 2px;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            font-size: 10px;
            color: #fff;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .ad-close.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* MINI AD INSIDE GAME MODALS */
        .game-mini-ad {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: linear-gradient(90deg, #f8f9fa, #e9ecef);
            border-top: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .game-mini-ad .mini-ad-content {
            font-size: 11px;
            color: #666;
        }

        .game-mini-ad .mini-ad-close {
            position: absolute;
            right: 3px;
            top: 3px;
            background: rgba(0, 0, 0, 0.2);
            border: none;
            font-size: 8px;
            color: #666;
            cursor: pointer;
            padding: 1px 4px;
            border-radius: 2px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .game-mini-ad .mini-ad-close.visible {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>

<body>
    <button class="back-btn" onclick="goBack()">‚Üê Back</button>

    <div class="container" id="hub">
        <div class="header">
            <h1>üéÆ Play to Win</h1>
            <p>Fun games, real coins!</p>
        </div>
        <div class="daily-limit">
            Today's earnings: <span id="gameEarnings">0</span> / 25 coins
            <span id="limitWarning" style="display:none;color:#ffeb3b;margin-left:10px;">‚úì Limit reached</span>
        </div>
        <div class="games-grid" id="gamesGrid"></div>
    </div>

    <!-- SPIN RESULT OVERLAY -->
    <div class="spin-result-overlay" id="spinResultOverlay">
        <div class="spin-result-box">
            <div class="spin-result-emoji" id="spinResultEmoji">üéØ</div>
            <div class="spin-result-title">You Won!</div>
            <div class="spin-result-coins" id="spinResultCoins">0 coins</div>
            <div class="spin-result-status" id="spinResultStatus">Processing reward...</div>
            <button class="spin-result-close" id="spinResultClose" onclick="closeSpinResult()"
                style="display:none;">Continue</button>
        </div>
    </div>

    <!-- SPIN GAME MODAL -->
    <div class="game-modal" id="spinModal">
        <div class="game-modal-inner">
            <div class="game-header">
                <button class="game-back-btn" onclick="closeGame('spinModal')">‚Üê Back to Games</button>
                <span class="game-plays-header" id="spinPlaysHeader">2 plays left</span>
            </div>
            <div class="game-content">
                <h2>üé° Spin & Win</h2>
                <p style="margin:10px 0;color:#666;">Spin to win 5-50 coins!</p>
                <div class="wheel-container">
                    <div class="wheel-pointer"></div>
                    <div class="wheel-highlight" id="spinHighlight"></div>
                    <div class="wheel" id="spinWheel">
                        <div class="wheel-label label-0">5 Coins</div>
                        <div class="wheel-label label-1">10 Coins</div>
                        <div class="wheel-label label-2">20 Coins</div>
                        <div class="wheel-label label-3">5 Coins</div>
                        <div class="wheel-label label-4">10 Coins</div>
                        <div class="wheel-label label-5">50 Coins</div>
                    </div>
                    <div class="wheel-status" id="wheelStatus"></div>
                </div>
                <div id="spinResult" class="result"></div>
                <button class="action-btn" id="spinBtn" onclick="spinWheel()">SPIN</button>

                <!-- Post-game actions -->
                <div class="post-game-actions" id="spinPostGame">
                    <div class="reward-claimed-text">‚úì Reward claimed</div>
                    <button class="back-to-hub-btn" onclick="closeGame('spinModal')">Back to Play to Win</button>
                </div>
            </div>
        </div>
        <!-- Mini Ad inside game modal -->
        <div class="game-mini-ad" id="spinMiniAd">
            <button class="mini-ad-close" id="spinMiniAdClose" onclick="closeMiniAd('spinMiniAd')">‚úï</button>
            <div class="mini-ad-content">üì± Ad Space - Revenue Partner</div>
        </div>
    </div>

    <!-- TAP GAME MODAL -->
    <div class="game-modal" id="tapModal">
        <div class="game-modal-inner">
            <div class="game-header">
                <button class="game-back-btn" onclick="closeGame('tapModal')">‚Üê Back to Games</button>
                <span class="game-plays-header" id="tapPlaysHeader">3 plays left</span>
            </div>
            <div class="game-content">
                <h2>üëÜ Tap Challenge</h2>
                <p style="margin:10px 0;color:#666;">Tap as fast as you can!</p>
                <div class="timer" id="tapTimer">10s</div>
                <div class="tap-count" id="tapCount">0</div>
                <div class="tap-area" id="tapArea" onclick="tapGame()">üëÜ</div>
                <div id="tapResult" class="result"></div>
                <button class="action-btn" id="tapStartBtn" onclick="startTapGame()">START</button>

                <!-- Post-game actions -->
                <div class="post-game-actions" id="tapPostGame">
                    <div class="reward-claimed-text">‚úì Reward claimed</div>
                    <button class="back-to-hub-btn" onclick="closeGame('tapModal')">Back to Play to Win</button>
                </div>
            </div>
        </div>
        <div class="game-mini-ad" id="tapMiniAd">
            <button class="mini-ad-close" id="tapMiniAdClose" onclick="closeMiniAd('tapMiniAd')">‚úï</button>
            <div class="mini-ad-content">üì± Ad Space - Revenue Partner</div>
        </div>
    </div>

    <!-- GUESS GAME MODAL -->
    <div class="game-modal" id="guessModal">
        <div class="game-modal-inner">
            <div class="game-header">
                <button class="game-back-btn" onclick="closeGame('guessModal')">‚Üê Back to Games</button>
                <span class="game-plays-header" id="guessPlaysHeader">2 plays left</span>
            </div>
            <div class="game-content">
                <h2>üî¢ Guess the Number</h2>
                <p style="margin:10px 0;color:#666;">Guess 1-10, 3 attempts!</p>
                <div class="attempts" id="guessAttempts">3 attempts left</div>
                <input type="number" class="guess-input" id="guessInput" min="1" max="10" placeholder="1-10">
                <div id="guessHint" style="margin:10px 0;color:#666;font-size:18px;"></div>
                <div id="guessResult" class="result"></div>
                <button class="action-btn" id="guessBtn" onclick="submitGuess()">GUESS</button>

                <!-- Post-game actions -->
                <div class="post-game-actions" id="guessPostGame">
                    <div class="reward-claimed-text">‚úì Reward claimed</div>
                    <button class="back-to-hub-btn" onclick="closeGame('guessModal')">Back to Play to Win</button>
                </div>
            </div>
        </div>
        <div class="game-mini-ad" id="guessMiniAd">
            <button class="mini-ad-close" id="guessMiniAdClose" onclick="closeMiniAd('guessMiniAd')">‚úï</button>
            <div class="mini-ad-content">üì± Ad Space - Revenue Partner</div>
        </div>
    </div>

    <!-- REACTION GAME MODAL -->
    <div class="game-modal" id="reactionModal">
        <div class="game-modal-inner">
            <div class="game-header">
                <button class="game-back-btn" onclick="closeGame('reactionModal')">‚Üê Back to Games</button>
                <span class="game-plays-header" id="reactionPlaysHeader">2 plays left</span>
            </div>
            <div class="game-content">
                <h2>‚ö° Reaction Game</h2>
                <p style="margin:10px 0;color:#666;">Wait for green, tap fast!</p>
                <div class="reaction-box waiting" id="reactionBox" onclick="reactionTap()">WAIT...</div>
                <div class="reaction-time" id="reactionTime"></div>
                <div id="reactionResult" class="result"></div>
                <button class="action-btn" id="reactionBtn" onclick="startReaction()">START</button>

                <!-- Post-game actions -->
                <div class="post-game-actions" id="reactionPostGame">
                    <div class="reward-claimed-text">‚úì Reward claimed</div>
                    <button class="back-to-hub-btn" onclick="closeGame('reactionModal')">Back to Play to Win</button>
                </div>
            </div>
        </div>
        <div class="game-mini-ad" id="reactionMiniAd">
            <button class="mini-ad-close" id="reactionMiniAdClose" onclick="closeMiniAd('reactionMiniAd')">‚úï</button>
            <div class="mini-ad-content">üì± Ad Space - Revenue Partner</div>
        </div>
    </div>

    <!-- QUIZ GAME MODAL -->
    <div class="game-modal" id="quizModal">
        <div class="game-modal-inner">
            <div class="game-header">
                <button class="game-back-btn" onclick="closeGame('quizModal')">‚Üê Back to Games</button>
                <span class="game-plays-header" id="quizPlaysHeader">99 plays left</span>
            </div>
            <div class="game-content">
                <h2>‚ùì Quiz Game</h2>
                <p style="margin:10px 0;color:#666;">5 coins per correct answer!</p>
                <div id="quizScore" style="font-size:20px;margin:10px 0;">Score: 0</div>
                <div class="quiz-question" id="quizQuestion">Loading...</div>
                <div class="quiz-options" id="quizOptions"></div>
                <div id="quizResult" class="result"></div>

                <!-- Post-game actions -->
                <div class="post-game-actions" id="quizPostGame">
                    <div class="reward-claimed-text">‚úì Reward claimed</div>
                    <button class="back-to-hub-btn" onclick="closeGame('quizModal')">Back to Play to Win</button>
                </div>
            </div>
        </div>
        <div class="game-mini-ad" id="quizMiniAd">
            <button class="mini-ad-close" id="quizMiniAdClose" onclick="closeMiniAd('quizMiniAd')">‚úï</button>
            <div class="mini-ad-content">üì± Ad Space - Revenue Partner</div>
        </div>
    </div>

    <!-- CATCH GAME MODAL -->
    <div class="game-modal" id="catchModal">
        <div class="game-modal-inner">
            <div class="game-header">
                <button class="game-back-btn" onclick="closeGame('catchModal')">‚Üê Back to Games</button>
                <span class="game-plays-header" id="catchPlaysHeader">2 plays left</span>
            </div>
            <div class="game-content">
                <h2>üéØ Catch the Button</h2>
                <p style="margin:10px 0;color:#666;">Catch the moving target!</p>
                <div class="timer" id="catchTimer">10s</div>
                <div id="catchScore">Caught: 0</div>
                <div class="catch-area" id="catchArea">
                    <div class="catch-target" id="catchTarget" onclick="catchClick()">üéØ</div>
                </div>
                <div id="catchResult" class="result"></div>
                <button class="action-btn" id="catchBtn" onclick="startCatch()">START</button>

                <!-- Post-game actions -->
                <div class="post-game-actions" id="catchPostGame">
                    <div class="reward-claimed-text">‚úì Reward claimed</div>
                    <button class="back-to-hub-btn" onclick="closeGame('catchModal')">Back to Play to Win</button>
                </div>
            </div>
        </div>
        <div class="game-mini-ad" id="catchMiniAd">
            <button class="mini-ad-close" id="catchMiniAdClose" onclick="closeMiniAd('catchMiniAd')">‚úï</button>
            <div class="mini-ad-content">üì± Ad Space - Revenue Partner</div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- STICKY BOTTOM AD BANNER -->
    <div class="sticky-ad" id="stickyAd">
        <button class="ad-close" onclick="closeAd()">‚úï</button>
        <div class="ad-content">
            <!-- Monetag/Adsterra banner code goes here -->
            <span style="color:#999;">üì¢ Ad Space - Monetag Banner</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const BACKEND_URL = 'https://microearn-worker.abusaifeshovon.workers.dev';
        let gamesData = [];
        let todayEarnings = 0;
        let limitReached = false;

        let spin50Locked = false; // Track weekly 50 coin lock
        let isSubmitting = false; // Anti-abuse: prevent double submissions

        // ========== AD CLOSE BUTTON DELAYED VISIBILITY ==========
        // Show global ad close button after 3 seconds
        setTimeout(() => {
            const adClose = document.querySelector('.ad-close');
            if (adClose) adClose.classList.add('visible');
        }, 3000);

        // Check if ad was closed in this session
        if (sessionStorage.getItem('adClosed')) {
            document.getElementById('stickyAd')?.classList.add('hidden');
        }

        function closeAd() {
            document.getElementById('stickyAd').classList.add('hidden');
            sessionStorage.setItem('adClosed', 'true');
        }

        function closeMiniAd(adId) {
            document.getElementById(adId)?.classList.add('hidden');
        }

        function showMiniAdClose(gameId) {
            // Show mini-ad close button after 5 seconds (delayed)
            setTimeout(() => {
                const closeBtn = document.getElementById(gameId + 'MiniAdClose');
                if (closeBtn) closeBtn.classList.add('visible');
            }, 5000);
        }

        async function loadGamesStatus() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/games/status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData: tg.initData })
                });
                const data = await response.json();
                if (data.success) {
                    gamesData = data.games;
                    todayEarnings = data.today_earnings || 0;
                    limitReached = data.limit_reached || false;
                    spin50Locked = data.spin_50_locked || false; // Update lock status
                    renderGames();
                } else {
                    showToast('‚ùå ' + (data.error || 'Failed to load'));
                }
            } catch (error) {
                console.error('Load error:', error);
                showToast('‚ùå Network error');
            }
        }

        function renderGames() {
            document.getElementById('gameEarnings').textContent = todayEarnings;
            document.getElementById('limitWarning').style.display = limitReached ? 'inline' : 'none';

            const gamesConfig = [
                { id: 'spin', icon: 'üé°', name: 'Spin & Win', reward: '5-50', maxPlays: 2 },
                { id: 'tap', icon: 'üëÜ', name: 'Tap Challenge', reward: '10-20', maxPlays: 3 },
                { id: 'quiz', icon: '‚ùì', name: 'Quiz Game', reward: '5/ans', maxPlays: 99 },
                { id: 'guess', icon: 'üî¢', name: 'Guess Number', reward: '20', maxPlays: 2 },
                { id: 'reaction', icon: '‚ö°', name: 'Reaction', reward: '10-20', maxPlays: 2 },
                { id: 'catch', icon: 'üéØ', name: 'Catch Button', reward: '10-20', maxPlays: 2 }
            ];

            const grid = document.getElementById('gamesGrid');
            grid.innerHTML = gamesConfig.map(game => {
                const gameData = gamesData.find(g => g.id === game.id) || { plays: 0 };
                const remainingPlays = game.maxPlays - (gameData.plays || 0);
                const disabled = limitReached || remainingPlays <= 0;
                const exhausted = remainingPlays <= 0;
                return `
                    <div class="game-card ${disabled ? 'disabled' : ''}" onclick="${disabled ? '' : `openGame('${game.id}')`}">
                        <div class="game-icon">${game.icon}</div>
                        <div class="game-title">${game.name}</div>
                        <div class="game-reward">+${game.reward}</div>
                        <div class="game-plays ${exhausted ? 'exhausted' : ''}">${exhausted ? 'Come back tomorrow' : remainingPlays + '/' + game.maxPlays + ' plays left'}</div>
                    </div>
                `;
            }).join('');
        }

        function updatePlaysHeader(gameId) {
            const gamesConfig = {
                spin: { maxPlays: 2, header: 'spinPlaysHeader' },
                tap: { maxPlays: 3, header: 'tapPlaysHeader' },
                guess: { maxPlays: 2, header: 'guessPlaysHeader' },
                reaction: { maxPlays: 2, header: 'reactionPlaysHeader' },
                quiz: { maxPlays: 99, header: 'quizPlaysHeader' },
                catch: { maxPlays: 2, header: 'catchPlaysHeader' }
            };
            const config = gamesConfig[gameId];
            if (!config) return;

            const gameData = gamesData.find(g => g.id === gameId) || { plays: 0 };
            const remaining = config.maxPlays - (gameData.plays || 0);
            const header = document.getElementById(config.header);
            if (header) {
                header.textContent = remaining <= 0 ? 'No plays left' : remaining + ' plays left';
                header.style.color = remaining <= 0 ? '#ff6b6b' : '#ffd700';
            }
        }

        function openGame(gameId) {
            document.getElementById(gameId + 'Modal').classList.add('show');
            updatePlaysHeader(gameId);
            showMiniAdClose(gameId);
            // Reset game state when opening
            if (gameId === 'quiz') startQuiz();
            if (gameId === 'guess') resetGuessGame();
            if (gameId === 'spin') resetSpinGame();
            if (gameId === 'tap') resetTapGame();
            if (gameId === 'reaction') resetReactionGame();
            if (gameId === 'catch') resetCatchGame();
        }

        function closeGame(modalId) {
            document.getElementById(modalId).classList.remove('show');
            loadGamesStatus(); // Refresh status when closing
        }

        // Improved reward submission with anti-abuse
        async function submitReward(gameType, score, reward, btnId) {
            if (isSubmitting) {
                showToast('‚è≥ Processing...');
                return 0;
            }

            isSubmitting = true;
            const btn = btnId ? document.getElementById(btnId) : null;

            if (btn) {
                btn.disabled = true;
                btn.textContent = '‚è≥ Processing...';
            }

            try {
                console.log('Submitting reward:', { gameType, score, reward });

                const response = await fetch(`${BACKEND_URL}/api/games/reward`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        initData: tg.initData,
                        game_type: gameType,
                        score: score,
                        reward: reward
                    })
                });

                const data = await response.json();
                console.log('Reward response:', data);

                if (data.success) {
                    showToast(`‚úÖ +${data.reward} coins added!`);
                    todayEarnings = data.today_game_earnings || todayEarnings + data.reward;
                    document.getElementById('gameEarnings').textContent = todayEarnings;

                    // CRITICAL: Refresh game data to update play counts
                    await loadGamesStatus();

                    if (btn) {
                        btn.textContent = '‚úì Claimed';
                        btn.classList.add('claimed');
                    }
                    return data.reward;
                } else {
                    // Show specific error
                    const errorMsg = data.error || 'Failed to claim reward';
                    showToast(`‚ùå ${errorMsg}`);

                    if (btn) {
                        btn.disabled = false;
                        btn.textContent = 'TRY AGAIN';
                    }
                    return 0;
                }
            } catch (error) {
                console.error('Reward error:', error);
                showToast('‚ùå Network error - check connection');

                if (btn) {
                    btn.disabled = false;
                    btn.textContent = 'TRY AGAIN';
                }
                return 0;
            } finally {
                isSubmitting = false;
            }
        }

        // === SPIN GAME ===
        let spinning = false;
        let spinSessionClaimed = false; // Prevent duplicate submissions
        const spinRewards = [5, 10, 20, 5, 10, 50];

        function resetSpinGame() {
            spinning = false;
            spinSessionClaimed = false;
            document.getElementById('spinWheel').style.transform = 'rotate(0deg)';
            document.getElementById('spinResult').textContent = '';
            document.getElementById('wheelStatus').textContent = '';
            document.getElementById('spinBtn').disabled = false;
            document.getElementById('spinBtn').textContent = 'SPIN';
            document.getElementById('spinBtn').classList.remove('claimed');
            document.getElementById('spinPostGame').classList.remove('show');

            // Reset visuals
            document.getElementById('spinHighlight').classList.remove('show');
            document.getElementById('spinWheel').classList.remove('dim');

            // Apply Lock Visuals
            const label50 = document.querySelector('.label-5');
            if (spin50Locked) {
                label50.style.opacity = '0.3';
                label50.innerHTML = 'üîí 50';
            } else {
                label50.style.opacity = '1';
                label50.innerHTML = '50 Coins';
            }
            document.getElementById('spinResultOverlay').classList.remove('show');
        }

        function showSpinResultOverlay(coins, status, showClose = false) {
            document.getElementById('spinResultCoins').textContent = `${coins} coins`;
            document.getElementById('spinResultStatus').textContent = status;
            document.getElementById('spinResultStatus').className = showClose ? 'spin-result-status spin-result-success' : 'spin-result-status';
            document.getElementById('spinResultClose').style.display = showClose ? 'block' : 'none';
            document.getElementById('spinResultOverlay').classList.add('show');
        }

        function closeSpinResult() {
            document.getElementById('spinResultOverlay').classList.remove('show');
        }

        async function spinWheel() {
            if (spinning || spinSessionClaimed) return;
            spinning = true;
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            btn.textContent = 'Spinning...';
            document.getElementById('spinResult').textContent = '';

            // Show SPINNING text in wheel center
            document.getElementById('wheelStatus').textContent = 'üé∞ Spinning...';

            const wheel = document.getElementById('spinWheel');
            const resultIndex = Math.floor(Math.random() * 6);
            /* 
               Rotation Math:
               5 full spins (1800deg) + alignment.
               Target: 360 - Center(Index).
               Center = Index * 60 + 30.
            */
            const deg = 360 * 5 + (360 - (resultIndex * 60 + 30));
            wheel.style.transform = `rotate(${deg}deg)`;

            setTimeout(async () => {
                const reward = spinRewards[resultIndex];

                // Highlight Winner & Dim rest
                document.getElementById('spinHighlight').classList.add('show');
                document.getElementById('spinWheel').classList.add('dim');
                document.getElementById('wheelStatus').textContent = `üéØ ${reward} coins!`;

                // Show Processing Result Box
                const resultDiv = document.getElementById('spinResult');
                resultDiv.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üéâ</div>
                        <div class="result-score">Wheel Result</div>
                        <div class="result-reward processing">Verifying...</div>
                    </div>
                `;

                // Process reward
                const earned = await submitReward('spin', resultIndex, reward, 'spinBtn');

                if (earned > 0) {
                    spinSessionClaimed = true;
                    // Update Text Status
                    document.getElementById('wheelStatus').textContent = `‚úì +${earned} Coins!`;

                    // Update Result Box
                    resultDiv.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">üéâ</div>
                            <div class="result-score">You Won: ${reward} Coins</div>
                            <div class="result-reward win">‚úì +${earned} Added!</div>
                        </div>
                    `;

                    // Show Overlay for extra pop
                    showSpinResultOverlay(earned, `‚úì +${earned} coins added!`, true);

                    // Show post-game actions
                    document.getElementById('spinPostGame').classList.add('show');
                    btn.textContent = '‚úì Claimed';
                } else {
                    document.getElementById('wheelStatus').textContent = '‚ùå Failed';
                    resultDiv.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">‚ùå</div>
                            <div class="result-score">Reward Failed</div>
                            <div class="result-reward lose">Could not add coins</div>
                        </div>
                    `;
                    showSpinResultOverlay(reward, '‚ùå Processing Failed', true);
                    btn.disabled = false;
                    btn.textContent = 'TRY AGAIN';
                }
                spinning = false;
            }, 5500);
        }

        // === TAP GAME ===
        let tapCount = 0, tapGameActive = false, tapInterval;

        function resetTapGame() {
            tapCount = 0;
            tapGameActive = false;
            clearInterval(tapInterval);
            document.getElementById('tapCount').textContent = '0';
            document.getElementById('tapTimer').textContent = '10s';
            document.getElementById('tapResult').textContent = '';
            document.getElementById('tapStartBtn').disabled = false;
            document.getElementById('tapStartBtn').textContent = 'START';
            document.getElementById('tapStartBtn').classList.remove('claimed');
            document.getElementById('tapPostGame').classList.remove('show');
        }

        function startTapGame() {
            tapCount = 0;
            tapGameActive = true;
            document.getElementById('tapCount').textContent = '0';
            document.getElementById('tapResult').textContent = '';
            document.getElementById('tapStartBtn').disabled = true;
            document.getElementById('tapStartBtn').textContent = 'Tapping...';
            let timeLeft = 10;
            document.getElementById('tapTimer').textContent = timeLeft + 's';

            tapInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('tapTimer').textContent = timeLeft + 's';
                if (timeLeft <= 0) {
                    clearInterval(tapInterval);
                    endTapGame();
                }
            }, 1000);
        }

        function tapGame() {
            if (!tapGameActive) return;
            tapCount++;
            document.getElementById('tapCount').textContent = tapCount;
        }

        async function endTapGame() {
            tapGameActive = false;
            let reward = 0;
            let requirement = '30+ taps';
            if (tapCount >= 81) { reward = 20; requirement = '81+ taps (MAX)'; }
            else if (tapCount >= 51) { reward = 15; requirement = '51+ taps'; }
            else if (tapCount >= 30) { reward = 10; requirement = '30+ taps'; }

            // Show detailed result with score breakdown
            const resultEl = document.getElementById('tapResult');

            if (reward > 0) {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üëÜ</div>
                        <div class="result-score">Your Score: ${tapCount} taps</div>
                        <div class="result-requirement">Requirement: ${requirement}</div>
                        <div class="result-reward win">üéâ +${reward} Coins</div>
                        <div class="result-message">‚è≥ Processing reward...</div>
                    </div>
                `;

                const earned = await submitReward('tap', tapCount, reward, 'tapStartBtn');

                if (earned > 0) {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">üéâ</div>
                            <div class="result-score">Your Score: ${tapCount} taps</div>
                            <div class="result-requirement">Requirement: ${requirement}</div>
                            <div class="result-reward win">‚úì +${earned} Coins Added!</div>
                            <div class="result-message">Balance updated successfully</div>
                        </div>
                    `;
                    document.getElementById('tapPostGame').classList.add('show');
                } else {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">‚ùå</div>
                            <div class="result-score">Your Score: ${tapCount} taps</div>
                            <div class="result-reward lose">Reward could not be added</div>
                            <div class="result-message">Please try again</div>
                        </div>
                    `;
                }
            } else {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üòî</div>
                        <div class="result-score">Your Score: ${tapCount} taps</div>
                        <div class="result-requirement">Requirement: 30+ taps needed</div>
                        <div class="result-reward lose">Reward: 0 Coins</div>
                        <div class="result-message">Try faster next time!</div>
                    </div>
                `;
                document.getElementById('tapStartBtn').disabled = false;
                document.getElementById('tapStartBtn').textContent = 'TRY AGAIN';
            }
        }

        // === GUESS GAME ===
        let secretNumber = 0, guessAttempts = 0;

        function resetGuessGame() {
            secretNumber = Math.floor(Math.random() * 10) + 1;
            guessAttempts = 0;
            document.getElementById('guessAttempts').textContent = '3 attempts left';
            document.getElementById('guessHint').textContent = '';
            document.getElementById('guessResult').textContent = '';
            document.getElementById('guessInput').value = '';
            document.getElementById('guessBtn').disabled = false;
            document.getElementById('guessBtn').textContent = 'GUESS';
            document.getElementById('guessBtn').classList.remove('claimed');
            document.getElementById('guessPostGame').classList.remove('show');
        }

        async function submitGuess() {
            const guess = parseInt(document.getElementById('guessInput').value);
            if (isNaN(guess) || guess < 1 || guess > 10) {
                showToast('Enter a number 1-10');
                return;
            }

            guessAttempts++;
            const remaining = 3 - guessAttempts;
            document.getElementById('guessAttempts').textContent = remaining + ' attempts left';

            const resultEl = document.getElementById('guessResult');

            if (guess === secretNumber) {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">ü§î</div>
                        <div class="result-score">Thinking...</div>
                        <div class="result-reward processing">Verifying...</div>
                    </div>
                `;

                const earned = await submitReward('guess', guessAttempts, 20, 'guessBtn');

                if (earned > 0) {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">üéâ</div>
                            <div class="result-score">Correct Number: ${secretNumber}</div>
                            <div class="result-reward win">‚úì +${earned} Coins Added!</div>
                            <div class="result-message">Great guess!</div>
                        </div>
                    `;
                    document.getElementById('guessPostGame').classList.add('show');
                } else {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">‚ùå</div>
                            <div class="result-score">Correct Number: ${secretNumber}</div>
                            <div class="result-reward lose">Reward Failed</div>
                            <div class="result-message">Could not add coins</div>
                        </div>
                    `;
                }
            } else {
                document.getElementById('guessHint').textContent = guess < secretNumber ? 'üìà Higher!' : 'üìâ Lower!';
                if (remaining <= 0) {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">üòî</div>
                            <div class="result-score">The number was: ${secretNumber}</div>
                            <div class="result-reward lose">Reward: 0 Coins</div>
                            <div class="result-message">Out of attempts!</div>
                        </div>
                    `;
                    document.getElementById('guessBtn').disabled = true;
                }
            }
            document.getElementById('guessInput').value = '';
        }

        // === REACTION GAME ===
        let reactionStartTime = 0, reactionWaiting = false, reactionTimeout;

        function resetReactionGame() {
            reactionStartTime = 0;
            reactionWaiting = false;
            clearTimeout(reactionTimeout);
            const box = document.getElementById('reactionBox');
            box.className = 'reaction-box waiting';
            box.textContent = 'WAIT...';
            document.getElementById('reactionTime').textContent = '';
            document.getElementById('reactionResult').textContent = '';
            document.getElementById('reactionBtn').disabled = false;
            document.getElementById('reactionBtn').textContent = 'START';
            document.getElementById('reactionBtn').classList.remove('claimed');
            document.getElementById('reactionPostGame').classList.remove('show');
        }

        function startReaction() {
            document.getElementById('reactionBtn').disabled = true;
            document.getElementById('reactionBtn').textContent = 'Wait...';
            document.getElementById('reactionTime').textContent = '';
            document.getElementById('reactionResult').textContent = '';
            const box = document.getElementById('reactionBox');
            box.className = 'reaction-box waiting';
            box.textContent = 'WAIT...';
            reactionWaiting = true;

            reactionTimeout = setTimeout(() => {
                box.className = 'reaction-box ready';
                box.textContent = 'TAP NOW!';
                reactionStartTime = Date.now();
                reactionWaiting = false;
            }, 2000 + Math.random() * 3000);
        }

        async function reactionTap() {
            if (reactionWaiting) {
                clearTimeout(reactionTimeout);
                document.getElementById('reactionResult').textContent = '‚ùå Too early!';
                document.getElementById('reactionResult').className = 'result lose';
                document.getElementById('reactionBtn').disabled = false;
                document.getElementById('reactionBtn').textContent = 'TRY AGAIN';
                const box = document.getElementById('reactionBox');
                box.className = 'reaction-box waiting';
                box.textContent = 'Too early';
                return;
            }

            if (reactionStartTime === 0) return;

            const reactionTime = Date.now() - reactionStartTime;
            reactionStartTime = 0;
            document.getElementById('reactionTime').textContent = reactionTime + 'ms';

            let reward = 0;
            let requirement = 'Need < 500ms';
            if (reactionTime < 300) { reward = 20; requirement = 'Lightning Fast! (<300ms)'; }
            else if (reactionTime < 500) { reward = 10; requirement = 'Fast Enough (<500ms)'; }

            const resultEl = document.getElementById('reactionResult');

            if (reward > 0) {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">‚ö°</div>
                        <div class="result-score">Time: ${reactionTime}ms</div>
                        <div class="result-requirement">Level: ${requirement}</div>
                        <div class="result-reward processing">Verifying...</div>
                    </div>
                `;

                const earned = await submitReward('reaction', reactionTime, reward, 'reactionBtn');

                if (earned > 0) {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">üéâ</div>
                            <div class="result-score">Time: ${reactionTime}ms</div>
                            <div class="result-reward win">‚úì +${earned} Coins Added!</div>
                            <div class="result-message">Excellent speed!</div>
                        </div>
                    `;
                    document.getElementById('reactionPostGame').classList.add('show');
                } else {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">‚ùå</div>
                            <div class="result-score">Time: ${reactionTime}ms</div>
                            <div class="result-reward lose">Reward Failed</div>
                            <div class="result-message">Could not add coins</div>
                        </div>
                    `;
                    document.getElementById('reactionBtn').disabled = false;
                    document.getElementById('reactionBtn').textContent = 'TRY AGAIN';
                }
            } else {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üê¢</div>
                        <div class="result-score">Time: ${reactionTime}ms</div>
                        <div class="result-requirement">Needed < 500ms</div>
                        <div class="result-reward lose">Reward: 0 Coins</div>
                        <div class="result-message">Too slow! Try again.</div>
                    </div>
                `;
                document.getElementById('reactionBtn').disabled = false;
                document.getElementById('reactionBtn').textContent = 'TRY AGAIN';
            }
        }

        // === QUIZ GAME ===
        const quizQuestions = [
            { q: 'What is 5 + 7?', options: ['10', '12', '13', '11'], correct: 1 },
            { q: 'Capital of France?', options: ['London', 'Berlin', 'Paris', 'Rome'], correct: 2 },
            { q: 'Largest planet?', options: ['Earth', 'Mars', 'Jupiter', 'Saturn'], correct: 2 },
            { q: 'H2O is?', options: ['Salt', 'Sugar', 'Water', 'Oil'], correct: 2 },
            { q: 'Days in a week?', options: ['5', '6', '7', '8'], correct: 2 }
        ];
        let quizScore = 0, quizIndex = 0;

        function startQuiz() {
            quizScore = 0;
            quizIndex = 0;
            document.getElementById('quizScore').textContent = 'Score: 0';
            document.getElementById('quizResult').textContent = '';
            showQuestion();
        }

        function showQuestion() {
            if (quizIndex >= quizQuestions.length) {
                endQuiz();
                return;
            }
            const q = quizQuestions[quizIndex];
            document.getElementById('quizQuestion').textContent = `Q${quizIndex + 1}: ${q.q}`;
            document.getElementById('quizOptions').innerHTML = q.options.map((opt, i) =>
                `<button class="quiz-option" onclick="answerQuiz(${i})">${opt}</button>`
            ).join('');
        }

        function answerQuiz(index) {
            const q = quizQuestions[quizIndex];
            const buttons = document.querySelectorAll('.quiz-option');
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.correct) btn.classList.add('correct');
                else if (i === index) btn.classList.add('wrong');
            });

            if (index === q.correct) quizScore += 5;
            document.getElementById('quizScore').textContent = 'Score: ' + quizScore;

            setTimeout(() => { quizIndex++; showQuestion(); }, 1000);
        }

        async function endQuiz() {
            document.getElementById('quizQuestion').textContent = 'Quiz Complete!';
            document.getElementById('quizOptions').innerHTML = '';

            const resultEl = document.getElementById('quizResult');
            let reward = quizScore; // 1:1 conversion

            if (reward > 0) {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üß†</div>
                        <div class="result-score">Final Score: ${quizScore}/25</div>
                        <div class="result-reward processing">Verifying...</div>
                    </div>
                `;

                const earned = await submitReward('quiz', quizScore, reward, null);

                if (earned > 0) {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">üéâ</div>
                            <div class="result-score">Score: ${quizScore}/25</div>
                            <div class="result-reward win">‚úì +${earned} Coins Added!</div>
                            <div class="result-message">Smart move!</div>
                        </div>
                    `;
                    document.getElementById('quizPostGame').classList.add('show');
                } else {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">‚ùå</div>
                            <div class="result-score">Score: ${quizScore}/25</div>
                            <div class="result-reward lose">Reward Failed</div>
                            <div class="result-message">Could not add coins</div>
                        </div>
                    `;
                }
            } else {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üòî</div>
                        <div class="result-score">Score: 0/25</div>
                        <div class="result-reward lose">Reward: 0 Coins</div>
                        <div class="result-message">Better luck next time!</div>
                    </div>
                `;
                resultEl.innerHTML += `<button onclick="startQuiz()" class="action-btn" style="margin-top:10px;">TRY AGAIN</button>`;
            }
        }

        // === CATCH GAME ===
        let catchScore = 0, catchActive = false, catchInterval, catchMoveInterval;

        function resetCatchGame() {
            catchScore = 0;
            catchActive = false;
            clearInterval(catchInterval);
            clearInterval(catchMoveInterval);
            document.getElementById('catchScore').textContent = 'Caught: 0';
            document.getElementById('catchTimer').textContent = '10s';
            document.getElementById('catchResult').textContent = '';
            document.getElementById('catchBtn').disabled = false;
            document.getElementById('catchBtn').textContent = 'START';
            document.getElementById('catchBtn').classList.remove('claimed');
            document.getElementById('catchPostGame').classList.remove('show');
        }

        function startCatch() {
            catchScore = 0;
            catchActive = true;
            document.getElementById('catchScore').textContent = 'Caught: 0';
            document.getElementById('catchResult').textContent = '';
            document.getElementById('catchBtn').disabled = true;
            document.getElementById('catchBtn').textContent = 'Catching...';
            moveTarget();

            catchMoveInterval = setInterval(moveTarget, 800);

            let timeLeft = 10;
            document.getElementById('catchTimer').textContent = timeLeft + 's';
            catchInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('catchTimer').textContent = timeLeft + 's';
                if (timeLeft <= 0) {
                    clearInterval(catchInterval);
                    clearInterval(catchMoveInterval);
                    endCatch();
                }
            }, 1000);
        }

        function moveTarget() {
            if (!catchActive) return;
            const area = document.getElementById('catchArea');
            const target = document.getElementById('catchTarget');
            const maxX = area.offsetWidth - 50;
            const maxY = area.offsetHeight - 50;
            target.style.left = Math.random() * maxX + 'px';
            target.style.top = Math.random() * maxY + 'px';
        }

        function catchClick() {
            if (!catchActive) return;
            catchScore++;
            document.getElementById('catchScore').textContent = 'Caught: ' + catchScore;
            moveTarget();
        }

        async function endCatch() {
            catchActive = false;
            let reward = 0;
            let requirement = '3+ Caught';
            if (catchScore >= 10) { reward = 20; requirement = '10+ Caught (MAX)'; }
            else if (catchScore >= 5) { reward = 15; requirement = '5+ Caught'; }
            else if (catchScore >= 3) { reward = 10; requirement = '3+ Caught'; }

            const resultEl = document.getElementById('catchResult');

            if (reward > 0) {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üé£</div>
                        <div class="result-score">Caught: ${catchScore}</div>
                        <div class="result-requirement">Requirement: ${requirement}</div>
                        <div class="result-reward processing">Verifying...</div>
                    </div>
                `;

                const earned = await submitReward('catch', catchScore, reward, 'catchBtn');

                if (earned > 0) {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">üéâ</div>
                            <div class="result-score">Caught: ${catchScore}</div>
                            <div class="result-requirement">Requirement: ${requirement}</div>
                            <div class="result-reward win">‚úì +${earned} Coins Added!</div>
                            <div class="result-message">Great catching!</div>
                        </div>
                    `;
                    document.getElementById('catchPostGame').classList.add('show');
                } else {
                    resultEl.innerHTML = `
                        <div class="game-result-box">
                            <div class="result-emoji">‚ùå</div>
                            <div class="result-score">Caught: ${catchScore}</div>
                            <div class="result-reward lose">Reward Failed</div>
                            <div class="result-message">Could not add coins</div>
                        </div>
                    `;
                }
            } else {
                resultEl.innerHTML = `
                    <div class="game-result-box">
                        <div class="result-emoji">üòî</div>
                        <div class="result-score">Caught: ${catchScore}</div>
                        <div class="result-requirement">Need 3+ to earn</div>
                        <div class="result-reward lose">Reward: 0 Coins</div>
                        <div class="result-message">Keep trying!</div>
                    </div>
                `;
                document.getElementById('catchBtn').disabled = false;
                document.getElementById('catchBtn').textContent = 'TRY AGAIN';
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function goBack() {
            window.location.href = 'index.html';
        }

        // Initialize
        loadGamesStatus();
    </script>
</body>

</html>
